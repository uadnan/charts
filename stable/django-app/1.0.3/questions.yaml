groups:
  - name: Container Image
    description: Image to be used for container
  - name: General Settings
    description: General Deployment Settings
  - name: App Configuration
    description: App Specific Config Options
  - name: Networking and Services
    description: Configure Network and Services for Container
  - name: Storage and Persistence
    description: Persist and Share Data that is Separate from the Container
  - name: Ingress
    description: Ingress Configuration
  - name: Security and Permissions
    description: Configure Security Context and Permissions
  - name: Resources and Devices
    description: "Specify Resources/Devices to be Allocated to Workload"
  - name: Middlewares
    description: Traefik Middlewares
  - name: Metrics
    description: Metrics
  - name: VPN
    description: VPN
  - name: Advanced
    description: Advanced Configuration
portals:
  open:
    protocols:
      - "$kubernetes-resource_configmap_portal_protocol"
    host:
      - "$kubernetes-resource_configmap_portal_host"
    ports:
      - "$kubernetes-resource_configmap_portal_port"
questions:
  - variable: image
    label: "Docker Image"
    group: "Container Image"
    schema:
      type: dict
      required: true
      attrs:
        - variable: repository
          description: "Docker image repository"
          label: "Image repository"
          schema:
            type: string
            required: true
        - variable: tag
          description: "Tag to use for specified image"
          label: "Image Tag"
          schema:
            type: string
            default: "latest"
        - variable: pullPolicy
          description: "Docker Image Pull Policy"
          label: "Image Pull Policy"
          schema:
            type: string
            default: "IfNotPresent"
            enum:
              - value: "IfNotPresent"
                description: "Only pull image if not present on host"
              - value: "Always"
                description: "Always pull image even if present on host"
              - value: "Never"
                description: "Never pull image even if it's not present on host"

  - variable: env
    group: "App Configuration"
    label: "Image Environment"
    schema:
      additional_attrs: true
      type: dict
      attrs:
        - variable: SENTRY_DSN
          label: "Sentry DSN"
          schema:
            type: string
            default: ""
            required: false
        - variable: DJANGO_SECRET_KEY
          label: "Django Secret Key"
          schema:
            type: string
            default: ""
            required: true
        - variable: EMAIL_HOST
          label: "Email Server Host"
          schema:
            type: string
            default: ""
            required: false
        - variable: EMAIL_HOST_USER
          label: "Email Server Username"
          schema:
            type: string
            default: ""
            required: false
        - variable: EMAIL_HOST_PASSWORD
          label: "Email Server Password"
          schema:
            type: string
            default: ""
            required: false
  - variable: ingress
    label: ""
    group: Ingress
    schema:
      additional_attrs: true
      type: dict
      attrs:
        - variable: main
          label: "Main Ingress"
          schema:
            additional_attrs: true
            type: dict
            attrs:
              - variable: enabled
                label: Enable Ingress
                schema:
                  type: boolean
                  default: false
                  show_subquestions_if: true
                  subquestions:
                    - variable: hosts
                      label: Hosts
                      schema:
                        type: list
                        default: [ ]
                        items:
                          - variable: hostEntry
                            label: Host
                            schema:
                              additional_attrs: true
                              type: dict
                              attrs:
                                - variable: host
                                  label: HostName
                                  schema:
                                    type: string
                                    default: ""
                                    required: true
                                - variable: paths
                                  label: Paths
                                  schema:
                                    type: list
                                    default: [ ]
                                    items:
                                      - variable: pathEntry
                                        label: Host
                                        schema:
                                          additional_attrs: true
                                          type: dict
                                          attrs:
                                            - variable: path
                                              label: Path
                                              schema:
                                                type: string
                                                required: true
                                                default: "/"
                                            - variable: pathType
                                              label: Path Type
                                              schema:
                                                type: string
                                                required: true
                                                default: Prefix
                    - variable: tls
                      label: TLS-Settings
                      schema:
                        type: list
                        default: [ ]
                        items:
                          - variable: tlsEntry
                            label: Host
                            schema:
                              additional_attrs: true
                              type: dict
                              attrs:
                                - variable: hosts
                                  label: Certificate Hosts
                                  schema:
                                    type: list
                                    default: [ ]
                                    items:
                                      - variable: host
                                        label: Host
                                        schema:
                                          type: string
                                          default: ""
                                          required: true
                                - variable: scaleCert
                                  label: Select TrueNAS SCALE Certificate
                                  schema:
                                    type: int
                                    $ref:
                                      - "definitions/certificate"
                    - variable: entrypoint
                      label: (Advanced) Traefik Entrypoint
                      description: Entrypoint used by Traefik when using Traefik as Ingress Provider
                      schema:
                        type: string
                        default: websecure
                        required: true
                    - variable: ingressClassName
                      label: (Advanced/Optional) IngressClass Name
                      schema:
                        type: string
                        default: ""
                    - variable: middlewares
                      label: Traefik Middlewares
                      description: Add previously created Traefik Middlewares to this Ingress
                      schema:
                        type: list
                        default: [ ]
                        items:
                          - variable: name
                            label: Name
                            schema:
                              type: string
                              default: ""
                              required: true
  - variable: ingressList
    label: Add Manual Custom Ingresses
    group: Ingress
    schema:
      type: list
      default: [ ]
      items:
        - variable: ingressListEntry
          label: Custom Ingress
          schema:
            additional_attrs: true
            type: dict
            attrs:
              - variable: enabled
                label: Enable Ingress
                schema:
                  type: boolean
                  default: true
                  hidden: true
              - variable: name
                label: Name
                schema:
                  type: string
                  default: ""
              - variable: ingressClassName
                label: IngressClass Name
                schema:
                  type: string
                  default: ""
              - variable: hosts
                label: Hosts
                schema:
                  type: list
                  default: [ ]
                  items:
                    - variable: hostEntry
                      label: Host
                      schema:
                        additional_attrs: true
                        type: dict
                        attrs:
                          - variable: host
                            label: HostName
                            schema:
                              type: string
                              default: ""
                              required: true
                          - variable: paths
                            label: Paths
                            schema:
                              type: list
                              default: [ ]
                              items:
                                - variable: pathEntry
                                  label: Host
                                  schema:
                                    additional_attrs: true
                                    type: dict
                                    attrs:
                                      - variable: path
                                        label: Path
                                        schema:
                                          type: string
                                          required: true
                                          default: "/"
                                      - variable: pathType
                                        label: Path Type
                                        schema:
                                          type: string
                                          required: true
                                          default: Prefix
                                      - variable: service
                                        label: Linked Service
                                        schema:
                                          additional_attrs: true
                                          type: dict
                                          attrs:
                                            - variable: name
                                              label: Service Name
                                              schema:
                                                type: string
                                                default: ""
                                            - variable: port
                                              label: Service Port
                                              schema:
                                                type: int
              - variable: tls
                label: TLS-Settings
                schema:
                  type: list
                  default: [ ]
                  items:
                    - variable: tlsEntry
                      label: Host
                      schema:
                        additional_attrs: true
                        type: dict
                        attrs:
                          - variable: hosts
                            label: Certificate Hosts
                            schema:
                              type: list
                              default: [ ]
                              items:
                                - variable: host
                                  label: Host
                                  schema:
                                    type: string
                                    default: ""
                                    required: true
                          - variable: scaleCert
                            label: Select TrueNAS SCALE Certificate
                            schema:
                              type: int
                              $ref:
                                - "definitions/certificate"
              - variable: entrypoint
                label: Traefik Entrypoint
                description: Entrypoint used by Traefik when using Traefik as Ingress Provider
                schema:
                  type: string
                  default: websecure
                  required: true
              - variable: middlewares
                label: Traefik Middlewares
                description: Add previously created Traefik Middlewares to this Ingress
                schema:
                  type: list
                  default: [ ]
                  items:
                    - variable: name
                      label: Name
                      schema:
                        type: string
                        default: ""
                        required: true
  - variable: security
    label: Container Security Settings
    group: Security and Permissions
    schema:
      type: dict
      additional_attrs: true
      attrs:
        - variable: editsecurity
          label: Change PUID / UMASK values
          description: By enabling this you override default set values.
          schema:
            type: boolean
            default: false
            show_subquestions_if: true
            subquestions:
              - variable: PUID
                label: Process User ID - PUID
                description: When supported by the container, this sets the User ID running the Application Process. Not supported by all Apps
                schema:
                  type: int
                  default: 568
              - variable: UMASK
                label: UMASK
                description: When supported by the container, this sets the UMASK for the App. Not supported by all Apps
                schema:
                  type: string
                  default: "002"
  - variable: advancedSecurity
    label: Show Advanced Security Settings
    group: Security and Permissions
    schema:
      type: boolean
      default: false
      show_subquestions_if: true
      subquestions:
        - variable: securityContext
          label: Security Context
          schema:
            additional_attrs: true
            type: dict
            attrs:
              - variable: privileged
                label: "Privileged mode"
                schema:
                  type: boolean
                  default: false
              - variable: readOnlyRootFilesystem
                label: "ReadOnly Root Filesystem"
                schema:
                  type: boolean
                  default: false
              - variable: allowPrivilegeEscalation
                label: "Allow Privilege Escalation"
                schema:
                  type: boolean
                  default: false
              - variable: runAsNonRoot
                label: "runAsNonRoot"
                schema:
                  type: boolean
                  default: false
  - variable: podSecurityContext
    group: Security and Permissions
    label: Pod Security Context
    schema:
      additional_attrs: true
      type: dict
      attrs:
        - variable: runAsUser
          label: "runAsUser"
          description: "The UserID of the user running the application"
          schema:
            type: int
            default: 0
        - variable: runAsGroup
          label: "runAsGroup"
          description: The groupID this App of the user running the application"
          schema:
            type: int
            default: 0
        - variable: fsGroup
          label: "fsGroup"
          description: "The group that should own ALL storage."
          schema:
            type: int
            default: 568
        - variable: fsGroupChangePolicy
          label: "When should we take ownership?"
          schema:
            type: string
            default: OnRootMismatch
            enum:
              - value: OnRootMismatch
                description: OnRootMismatch
              - value: Always
                description: Always
        - variable: supplementalGroups
          label: Supplemental Groups
          schema:
            type: list
            default: [ ]
            items:
              - variable: supplementalGroupsEntry
                label: Supplemental Group
                schema:
                  type: int
  - variable: resources
    group: Resources and Devices
    label: "Resource Limits"
    schema:
      additional_attrs: true
      type: dict
      attrs:
        - variable: limits
          label: Advanced Limit Resource Consumption
          schema:
            additional_attrs: true
            type: dict
            attrs:
              - variable: cpu
                label: CPU
                description: "1000m means 1 hyperthread. Detailed info: https://truecharts.org/docs/manual/SCALE%20Apps/indepth/validation"
                schema:
                  type: string
                  default: 4000m
                  valid_chars: '^(?!^0(\.0|m|)$)([0-9]+)(\.[0-9]|m?)$'
              - variable: memory
                label: RAM
                description: "1Gi means 1 Gibibyte RAM. Detailed info: https://truecharts.org/docs/manual/SCALE%20Apps/indepth/validation"
                schema:
                  type: string
                  default: 8Gi
                  valid_chars: '^(?!^0(e[0-9]|[EPTGMK]i?|)$)([0-9]+)(|[EPTGMK]i?|e[0-9]+)$'
        - variable: requests
          label: "Minimum Resources Required (request)"
          schema:
            additional_attrs: true
            type: dict
            hidden: true
            attrs:
              - variable: cpu
                label: CPU
                description: "1000m means 1 hyperthread. Detailed info: https://truecharts.org/docs/manual/SCALE%20Apps/indepth/validation"
                schema:
                  type: string
                  default: 10m
                  hidden: true
                  valid_chars: '^(?!^0(\.0|m|)$)([0-9]+)(\.[0-9]|m?)$'
              - variable: memory
                label: "RAM"
                description: "1Gi means 1 Gibibyte RAM. Detailed info: https://truecharts.org/docs/manual/SCALE%20Apps/indepth/validation"
                schema:
                  type: string
                  default: 50Mi
                  hidden: true
                  valid_chars: '^(?!^0(e[0-9]|[EPTGMK]i?|)$)([0-9]+)(|[EPTGMK]i?|e[0-9]+)$'
  - variable: deviceList
    label: Mount USB Devices
    group: Resources and Devices
    schema:
      type: list
      default: [ ]
      items:
        - variable: deviceListEntry
          label: Device
          schema:
            additional_attrs: true
            type: dict
            attrs:
              - variable: enabled
                label: Enable the Storage
                schema:
                  type: boolean
                  default: true
              - variable: type
                label: (Advanced) Type of Storage
                description: Sets the persistence type
                schema:
                  type: string
                  default: hostPath
                  hidden: true
              - variable: readOnly
                label: readOnly
                schema:
                  type: boolean
                  default: false
              - variable: hostPath
                label: Host Device Path
                description: Path to the device on the host system
                schema:
                  type: path
              - variable: mountPath
                label: Container Device Path
                description: Path inside the container the device is mounted
                schema:
                  type: string
                  default: "/dev/ttyACM0"
  - variable: networkPolicy
    group: Advanced
    label: (Advanced) Network Policy
    schema:
      type: list
      default: [ ]
      items:
        - variable: netPolicyEntry
          label: Network Policy Entry
          schema:
            additional_attrs: true
            type: dict
            attrs:
              - variable: name
                label: Name
                schema:
                  type: string
                  required: true
                  default: ""
              - variable: enabled
                label: Enabled
                schema:
                  type: boolean
                  default: false
                  show_subquestions_if: true
                  subquestions:
                    - variable: policyType
                      label: Policy Type
                      schema:
                        type: string
                        default: ""
                        enum:
                          - value: ""
                            description: Default
                          - value: ingress
                            description: Ingress
                          - value: egress
                            description: Egress
                          - value: ingress-egress
                            description: Ingress and Egress
                    - variable: egress
                      label: Egress
                      schema:
                        type: list
                        default: [ ]
                        items:
                          - variable: egressEntry
                            label: ""
                            schema:
                              additional_attrs: true
                              type: dict
                              attrs:
                                - variable: to
                                  label: To
                                  schema:
                                    type: list
                                    default: [ ]
                                    items:
                                      - variable: toEntry
                                        label: ""
                                        schema:
                                          additional_attrs: true
                                          type: dict
                                          attrs:
                                            - variable: ipBlock
                                              label: IP Block
                                              schema:
                                                additional_attrs: true
                                                type: dict
                                                attrs:
                                                  - variable: cidr
                                                    label: CIDR
                                                    schema:
                                                      type: string
                                                      default: ""
                                                  - variable: except
                                                    label: Except
                                                    schema:
                                                      type: list
                                                      default: [ ]
                                                      items:
                                                        - variable: exceptint
                                                          label: ""
                                                          schema:
                                                            type: string
                                            - variable: namespaceSelector
                                              label: Namespace Selector
                                              schema:
                                                additional_attrs: true
                                                type: dict
                                                attrs:
                                                  - variable: matchExpressions
                                                    label: Match Expressions
                                                    schema:
                                                      type: list
                                                      default: [ ]
                                                      items:
                                                        - variable: expressionEntry
                                                          label: ""
                                                          schema:
                                                            additional_attrs: true
                                                            type: dict
                                                            attrs:
                                                              - variable: key
                                                                label: Key
                                                                schema:
                                                                  type: string
                                                              - variable: operator
                                                                label: Operator
                                                                schema:
                                                                  type: string
                                                                  default: TCP
                                                                  enum:
                                                                    - value: In
                                                                      description: In
                                                                    - value: NotIn
                                                                      description: NotIn
                                                                    - value: Exists
                                                                      description: Exists
                                                                    - value: DoesNotExist
                                                                      description: DoesNotExist
                                                              - variable: values
                                                                label: Values
                                                                schema:
                                                                  type: list
                                                                  default: [ ]
                                                                  items:
                                                                    - variable: value
                                                                      label: ""
                                                                      schema:
                                                                        type: string
                                            - variable: podSelector
                                              label: ""
                                              schema:
                                                additional_attrs: true
                                                type: dict
                                                attrs:
                                                  - variable: matchExpressions
                                                    label: Match Expressions
                                                    schema:
                                                      type: list
                                                      default: [ ]
                                                      items:
                                                        - variable: expressionEntry
                                                          label: ""
                                                          schema:
                                                            additional_attrs: true
                                                            type: dict
                                                            attrs:
                                                              - variable: key
                                                                label: Key
                                                                schema:
                                                                  type: string
                                                              - variable: operator
                                                                label: Operator
                                                                schema:
                                                                  type: string
                                                                  default: TCP
                                                                  enum:
                                                                    - value: In
                                                                      description: In
                                                                    - value: NotIn
                                                                      description: NotIn
                                                                    - value: Exists
                                                                      description: Exists
                                                                    - value: DoesNotExist
                                                                      description: DoesNotExist
                                                              - variable: values
                                                                label: Values
                                                                schema:
                                                                  type: list
                                                                  default: [ ]
                                                                  items:
                                                                    - variable: value
                                                                      label: ""
                                                                      schema:
                                                                        type: string
                                - variable: ports
                                  label: Ports
                                  schema:
                                    type: list
                                    default: [ ]
                                    items:
                                      - variable: portsEntry
                                        label: ""
                                        schema:
                                          additional_attrs: true
                                          type: dict
                                          attrs:
                                            - variable: port
                                              label: Port
                                              schema:
                                                type: int
                                            - variable: endPort
                                              label: End Port
                                              schema:
                                                type: int
                                            - variable: protocol
                                              label: Protocol
                                              schema:
                                                type: string
                                                default: TCP
                                                enum:
                                                  - value: TCP
                                                    description: TCP
                                                  - value: UDP
                                                    description: UDP
                                                  - value: SCTP
                                                    description: SCTP
                    - variable: ingress
                      label: Ingress
                      schema:
                        type: list
                        default: [ ]
                        items:
                          - variable: ingressEntry
                            label: ""
                            schema:
                              additional_attrs: true
                              type: dict
                              attrs:
                                - variable: from
                                  label: From
                                  schema:
                                    type: list
                                    default: [ ]
                                    items:
                                      - variable: fromEntry
                                        label: ""
                                        schema:
                                          additional_attrs: true
                                          type: dict
                                          attrs:
                                            - variable: ipBlock
                                              label: IP Block
                                              schema:
                                                additional_attrs: true
                                                type: dict
                                                attrs:
                                                  - variable: cidr
                                                    label: CIDR
                                                    schema:
                                                      type: string
                                                      default: ""
                                                  - variable: except
                                                    label: Except
                                                    schema:
                                                      type: list
                                                      default: [ ]
                                                      items:
                                                        - variable: exceptint
                                                          label: ""
                                                          schema:
                                                            type: string
                                            - variable: namespaceSelector
                                              label: Namespace Selector
                                              schema:
                                                additional_attrs: true
                                                type: dict
                                                attrs:
                                                  - variable: matchExpressions
                                                    label: Match Expressions
                                                    schema:
                                                      type: list
                                                      default: [ ]
                                                      items:
                                                        - variable: expressionEntry
                                                          label: ""
                                                          schema:
                                                            additional_attrs: true
                                                            type: dict
                                                            attrs:
                                                              - variable: key
                                                                label: Key
                                                                schema:
                                                                  type: string
                                                              - variable: operator
                                                                label: Operator
                                                                schema:
                                                                  type: string
                                                                  default: TCP
                                                                  enum:
                                                                    - value: In
                                                                      description: In
                                                                    - value: NotIn
                                                                      description: NotIn
                                                                    - value: Exists
                                                                      description: Exists
                                                                    - value: DoesNotExist
                                                                      description: DoesNotExist
                                                              - variable: values
                                                                label: Values
                                                                schema:
                                                                  type: list
                                                                  default: [ ]
                                                                  items:
                                                                    - variable: value
                                                                      label: ""
                                                                      schema:
                                                                        type: string
                                            - variable: podSelector
                                              label: ""
                                              schema:
                                                additional_attrs: true
                                                type: dict
                                                attrs:
                                                  - variable: matchExpressions
                                                    label: Match Expressions
                                                    schema:
                                                      type: list
                                                      default: [ ]
                                                      items:
                                                        - variable: expressionEntry
                                                          label: ""
                                                          schema:
                                                            additional_attrs: true
                                                            type: dict
                                                            attrs:
                                                              - variable: key
                                                                label: Key
                                                                schema:
                                                                  type: string
                                                              - variable: operator
                                                                label: Operator
                                                                schema:
                                                                  type: string
                                                                  default: TCP
                                                                  enum:
                                                                    - value: In
                                                                      description: In
                                                                    - value: NotIn
                                                                      description: NotIn
                                                                    - value: Exists
                                                                      description: Exists
                                                                    - value: DoesNotExist
                                                                      description: DoesNotExist
                                                              - variable: values
                                                                label: Values
                                                                schema:
                                                                  type: list
                                                                  default: [ ]
                                                                  items:
                                                                    - variable: value
                                                                      label: ""
                                                                      schema:
                                                                        type: string
                                - variable: ports
                                  label: Ports
                                  schema:
                                    type: list
                                    default: [ ]
                                    items:
                                      - variable: portsEntry
                                        label: ""
                                        schema:
                                          additional_attrs: true
                                          type: dict
                                          attrs:
                                            - variable: port
                                              label: Port
                                              schema:
                                                type: int
                                            - variable: endPort
                                              label: End Port
                                              schema:
                                                type: int
                                            - variable: protocol
                                              label: Protocol
                                              schema:
                                                type: string
                                                default: TCP
                                                enum:
                                                  - value: TCP
                                                    description: TCP
                                                  - value: UDP
                                                    description: UDP
                                                  - value: SCTP
                                                    description: SCTP
